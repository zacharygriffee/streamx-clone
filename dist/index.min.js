function t(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var i=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(i,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),i}var e,i={exports:{}},r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}i.exports=a;var l=i.exports.once=function(t,e){return new Promise((function(i,r){function n(i){t.removeListener(e,s),r(i)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",n),i([].slice.call(arguments))}m(t,e,s,{once:!0}),"error"!==e&&function(t,e){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,n)}))};a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function o(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function d(t,e,i,r){var n,s,a,l;if(o(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),a=s[e]),void 0===a)a=s[e]=i,++t._eventsCount;else if("function"==typeof a?a=s[e]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(n=h(t))>0&&a.length>n&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=a.length,l=u,console&&console.warn&&console.warn(l)}return t}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=p.bind(r);return n.listener=i,r.wrapFn=n,n}function c(t,e,i){var r=t._events;if(void 0===r)return[];var n=r[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):S(n,n.length)}function _(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function S(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function m(t,e,i,r){if("function"==typeof t.on)r.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(s){r.once&&t.removeEventListener(e,n),i(s)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");u=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var l=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var u=s[t];if(void 0===u)return!1;if("function"==typeof u)n(u,this,e);else{var o=u.length,h=S(u,o);for(i=0;i<o;++i)n(h[i],this,e)}return!0},a.prototype.addListener=function(t,e){return d(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return d(this,t,e,!0)},a.prototype.once=function(t,e){return o(e),this.on(t,f(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return o(e),this.prependListener(t,f(this,t,e)),this},a.prototype.removeListener=function(t,e){var i,r,n,s,a;if(o(e),void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){a=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,n),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},a.prototype.listeners=function(t){return c(this,t,!0)},a.prototype.rawListeners=function(t){return c(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):_.call(t,e)},a.prototype.listenerCount=_,a.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};var b=i.exports,x=i.exports.EventEmitter,v=i.exports.init,y=i.exports.listenerCount,w=t(Object.freeze({__proto__:null,EventEmitter:x,default:b,init:v,listenerCount:y,once:l})),g="function"==typeof queueMicrotask?queueMicrotask:t=>Promise.resolve().then(t);const k=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}};var L=t(Object.freeze({__proto__:null,clone:function(t,e){return new class extends Vt.Readable{constructor(t,e){super(e),t.on("data",(t=>{this.push(t)})),t.on("end",(()=>{this.push(null)})),t.on("error",(t=>{this.emit("error",t)}))}}(t,e)}}));const{EventEmitter:T}=w,E=new Error("Stream was destroyed"),N=new Error("Premature close"),P=g,O=class{constructor(t){this.hwm=t||16,this.head=new k(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new k(2*this.head.buffer.length),this.head.push(t)}}shift(){0!==this.length&&this.length--;const t=this.tail.shift();if(void 0===t&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return t}peek(){const t=this.tail.peek();return void 0===t&&this.tail.next?this.tail.next.peek():t}isEmpty(){return 0===this.length}},M=L,C=536870911,j=1^C,W=2^C,A=64,R=128,F=256,q=1024,U=2048,I=4096,B=8192,z=16384,D=32768,K=131072,G=131328,H=16^C,J=768^C,Q=536838143,V=32^C,X=536739839,Y=2<<18,Z=4<<18,$=8<<18,tt=16<<18,et=32<<18,it=64<<18,rt=128<<18,nt=256<<18,st=512<<18,at=1024<<18,lt=469499903,ut=535822335,ot=503316479,ht=268435455,dt=262160,pt=536608751,ft=8404992,ct=14,_t=15,St=8405006,mt=33587200,bt=33587215,xt=2359296,vt=270794767,yt=Symbol.asyncIterator||Symbol("asyncIterator");class wt{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:r,byteLength:n,byteLengthWritable:s}={}){this.stream=t,this.queue=new O,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||n||Ht,this.map=r||i,this.afterWrite=Pt.bind(this),this.afterUpdateNextTick=Ct.bind(this)}get ended(){return!!(this.stream._duplexState&et)}push(t){return null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=$,!0):(this.stream._duplexState|=6291456,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|st)&ut}autoBatch(t,e){const i=[],r=this.stream;for(i.push(t);(r._duplexState&vt)===xt;)i.push(r._writableState.shift());if(r._duplexState&_t)return e(null);r._writev(i,e)}update(){const t=this.stream;t._duplexState|=Y;do{for(;(t._duplexState&vt)===$;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite)}1310720&t._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());t._duplexState&=536346623}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===st)return t._duplexState=402653183&t._duplexState|262144,void t._final(Et.bind(this));4!=(t._duplexState&ct)?1==(t._duplexState&bt)&&(t._duplexState=(t._duplexState|dt)&j,t._open(jt.bind(this))):t._duplexState&mt||(t._duplexState|=dt,t._destroy(Nt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&rt)&&(this.stream._duplexState&=ot,!0)}updateCallback(){(35127311&this.stream._duplexState)===Z?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&rt||(this.stream._duplexState|=rt,this.stream._duplexState&Y||P(this.afterUpdateNextTick))}}class gt{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:r,byteLength:n,byteLengthReadable:s}={}){this.stream=t,this.queue=new O,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=s||n||Ht,this.map=r||i,this.pipeTo=null,this.afterRead=Ot.bind(this),this.afterUpdateNextTick=Mt.bind(this)}get ended(){return!!(this.stream._duplexState&z)}pipe(t,e){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new Lt(this.stream,t,e),e&&this.stream.on("error",Jt),Gt(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Jt),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const e=this.pipeline.done.bind(this.pipeline,t),i=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",i),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Tt.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&e._duplexState|1024,!1):(null!==this.map&&null===(t=this.map(t))||(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=536805375&e._duplexState|128),this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const i=e[t];this.buffered+=this.byteLength(i),this.queue.push(i)}this.push(e[e.length-1])}read(){const t=this.stream;if((16527&t._duplexState)===R){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=J),t._duplexState&U&&t.emit("data",e),e}return!1===this.readAhead&&(t._duplexState|=K,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===R&&768&t._duplexState;){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=J),t._duplexState&U&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===K;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=B,t.emit("readable")),80&t._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());t._duplexState&=V}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===q&&(t._duplexState=536869887&t._duplexState|16384,t.emit("end"),(t._duplexState&St)===ft&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&ct)?1==(t._duplexState&bt)&&(t._duplexState=(t._duplexState|dt)&j,t._open(jt.bind(this))):t._duplexState&mt||(t._duplexState|=dt,t._destroy(Nt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&D)&&(this.stream._duplexState&=Q,!0)}updateCallback(){(32879&this.stream._duplexState)===A?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&D||(this.stream._duplexState|=D,32&this.stream._duplexState||P(this.afterUpdateNextTick))}}class kt{constructor(t){this.data=null,this.afterTransform=Wt.bind(t),this.afterFinal=null}}class Lt{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):t._duplexState&z||this.to.destroy(this.error||new Error("Readable stream closed before ending")):this.from._duplexState&z&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}function Tt(){this.stream._duplexState|=512,this.updateCallback()}function Et(t){const e=this.stream;t&&e.destroy(t),e._duplexState&ct||(e._duplexState|=et,e.emit("finish")),(e._duplexState&St)===ft&&(e._duplexState|=4),e._duplexState&=lt,e._duplexState&Y?this.updateNextTick():this.update()}function Nt(t){const e=this.stream;t||this.error===E||(t=this.error),t&&e.emit("error",t),e._duplexState|=8,e.emit("close");const i=e._readableState,r=e._writableState;if(null!==i&&null!==i.pipeline&&i.pipeline.done(e,t),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(e,t)}}function Pt(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=lt,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--)}(this.drains),(6553615&e._duplexState)===tt&&(e._duplexState&=532676607,(e._duplexState&it)===it&&e.emit("drain")),this.updateCallback()}function Ot(t){t&&this.stream.destroy(t),this.stream._duplexState&=H,!1!==this.readAhead||this.stream._duplexState&F||(this.stream._duplexState&=X),this.updateCallback()}function Mt(){32&this.stream._duplexState||(this.stream._duplexState&=Q,this.update())}function Ct(){this.stream._duplexState&Y||(this.stream._duplexState&=ot,this.update())}function jt(t){const e=this.stream;t&&e.destroy(t),4&e._duplexState||(17423&e._duplexState||(e._duplexState|=A),142606351&e._duplexState||(e._duplexState|=Z),e.emit("open")),e._duplexState&=pt,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback()}function Wt(t,e){null!=e&&this.push(e),this._writableState.afterWrite(t)}function At(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=I,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=it,this._writableState.updateNextTick())}class Rt extends T{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",Qt.bind(this))),this.on("newListener",At)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(this._duplexState&ct)}destroy(t){this._duplexState&ct||(t||(t=E),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=W,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class Ft extends Rt{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new gt(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=X),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new M(t),i=this._readableState.map||Dt;return this._readableState.map=function(t){const r=e.push(t);return""===r?null:i(r)},this}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=G,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let i;const r=new Ft({...e,read(e){t.next().then(n).then(e.bind(null,null)).catch(e)},predestroy(){i=t.return()},destroy(t){if(!i)return t(null);i.then(t.bind(null,null)).catch(t)}});return r;function n(t){t.done?r.push(null):r.push(t.value)}}static from(t,e){if(Gt(i=t)&&i.readable)return t;var i;if(t[yt])return this._fromAsyncIterator(t[yt](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let r=0;return new Ft({...e,read(e){this.push(r===t.length?null:t[r++]),e(null)}})}static isBackpressured(t){return!!(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return!(t._duplexState&F)}[yt](){const t=this;let e=null,i=null,r=null;return this.on("error",(t=>{e=t})),this.on("readable",(function(){null!==i&&n(t.read())})),this.on("close",(function(){null!==i&&n(null)})),{[yt](){return this},next:()=>new Promise((function(e,s){i=e,r=s;const a=t.read();null!==a?n(a):8&t._duplexState&&n(null)})),return:()=>s(null),throw:t=>s(t)};function n(n){null!==r&&(e?r(e):null!==n||t._duplexState&z?i({value:n,done:null===n}):r(E),r=i=null)}function s(e){return t.destroy(e),new Promise(((i,r)=>{if(8&t._duplexState)return i({value:void 0,done:!0});t.once("close",(function(){e?r(e):i({value:void 0,done:!0})}))}))}}}class qt extends Rt{constructor(t){super(t),this._duplexState|=16385,this._writableState=new wt(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=at}uncork(){this._duplexState&=ht,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return!!(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,i=function(t){return t._writev!==qt.prototype._writev&&t._writev!==Ut.prototype._writev}(t)?Math.min(1,e.queue.length):e.queue.length,r=i+(t._duplexState&nt?1:0);return 0===r?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:r,resolve:t})})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class Ut extends Ft{constructor(t){super(t),this._duplexState=1|this._duplexState&K,this._writableState=new wt(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=at}uncork(){this._duplexState&=ht,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class It extends Ut{constructor(t){super(t),this._transformState=new kt(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(null!==this._transformState.data){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(Bt.bind(this))}}function Bt(t,e){const i=this._transformState.afterFinal;if(t)return i(t);null!=e&&this.push(e),this.push(null),i(null)}function zt(t,...e){const i=Array.isArray(t)?[...t,...e]:[t,...e],r=i.length&&"function"==typeof i[i.length-1]?i.pop():null;if(i.length<2)throw new Error("Pipeline requires at least 2 streams");let n=i[0],s=null,a=null;for(let t=1;t<i.length;t++)s=i[t],Gt(n)?n.pipe(s,u):(l(n,!0,t>1,u),n.pipe(s)),n=s;if(r){let t=!1;const e=Gt(s)||!(!s._writableState||!s._writableState.autoDestroy);s.on("error",(t=>{null===a&&(a=t)})),s.on("finish",(()=>{t=!0,e||r(a)})),e&&s.on("close",(()=>r(a||(t?null:N))))}return s;function l(t,e,i,r){t.on("error",r),t.on("close",(function(){if(t._readableState&&!t._readableState.ended)return r(N);if(i&&t._writableState&&!t._writableState.ended)return r(N)}))}function u(t){if(t&&!a){a=t;for(const e of i)e.destroy(t)}}}function Dt(t){return t}function Kt(t){return!!t._readableState||!!t._writableState}function Gt(t){return"number"==typeof t._duplexState&&Kt(t)}function Ht(t){return function(t){return"object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function Jt(){}function Qt(){this.destroy(new Error("Stream aborted."))}var Vt={pipeline:zt,pipelinePromise:function(...t){return new Promise(((e,i)=>zt(...t,(t=>{if(t)return i(t);e()}))))},isStream:Kt,isStreamx:Gt,getStreamError:function(t){const e=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return e===E?null:e},Stream:Rt,Writable:qt,Readable:Ft,Duplex:Ut,Transform:It,PassThrough:class extends It{}};function Xt(t,e){return new class extends Vt.Readable{constructor(t,e){super(e),t.on("data",(t=>{this.push(t)})),t.on("end",(()=>{this.push(null)})),t.on("error",(t=>{this.emit("error",t)}))}}(t,e)}export{Xt as clone};
